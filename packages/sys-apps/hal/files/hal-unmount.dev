#!/bin/sh

DeviceMounted() { grep -q "^$1" /proc/mounts || grep -q "^$1" /etc/mtab ; }

# sanity check. DEVNAME should start with a /
[ "$DEVNAME" != "${DEVNAME#/}" ] || exit 0

# Lazily unmount drives which are removed, but still mounted
if [ "$ACTION" = remove ] && DeviceMounted "$DEVNAME" ; then
   if [ -x /usr/bin/pumount ] ; then
      /usr/bin/pumount -l "$DEVNAME";
   else
      /bin/umount -l "$DEVNAME";
   fi
fi

exit 0
